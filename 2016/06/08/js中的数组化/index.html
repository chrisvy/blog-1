<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> js中的数组化 · Jesse's life</title><meta name="description" content="js中的数组化 - Jesse"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="short icon" href="http://ob3wg7deo.bkt.clouddn.com/batman_1.png"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.css"><link rel="search" type="application/opensearchdescription+xml" href="http://chenjiangsong.github.io/blog/atom.xml" title="Jesse's life"></head><body><div class="wrap"><header><a href="/blog/" class="logo-link"><img src="http://ob3wg7deo.bkt.clouddn.com/batman.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="/blog/tags/" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="http://weibo.com/jesseccchen" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/chenjiangsong" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">js中的数组化<span class="post-author"></span></h1><div class="post-info">2016年6月8日</div><div class="post-content"><p>浏览器下有很多<strong>类数组对象</strong></p><ul><li>arguments</li><li>HTMLCollection（document.getElementsByTagName等方式获取的节点集合）</li><li>特殊写法的自定义对象arrayLike，如下：<a id="more"></a></li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> arrayLike = &#123;</div><div class="line">  <span class="number">0</span>:<span class="string">'a'</span>,</div><div class="line">  <span class="number">1</span>:<span class="string">'b'</span>,</div><div class="line">  <span class="number">2</span>:<span class="string">'c'</span>,</div><div class="line">  length:<span class="number">3</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>先用<code>Object.prototype.toString.call()</code>检测一下这三种类数组对象的数据类型</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">arguments</span>) <span class="comment">//[object Arguments]</span></div><div class="line"><span class="built_in">Object</span>.prototype.toString.call(<span class="built_in">document</span>.getElementsByTagName(<span class="string">'div'</span>)) <span class="comment">// [object HTMLCollection]</span></div><div class="line"><span class="built_in">Object</span>.prototype.toString.call(arrayLike) <span class="comment">// [object Object]</span></div></pre></td></tr></table></figure><h3 id="数组化的三种方法"><a href="#数组化的三种方法" class="headerlink" title="数组化的三种方法"></a>数组化的三种方法</h3><h4 id="Array-prototype-slice-call"><a href="#Array-prototype-slice-call" class="headerlink" title="Array.prototype.slice.call"></a>Array.prototype.slice.call</h4><p>类数组对象的数组化 最简单的方法是 <code>Array.prototype.slice.call</code>。但在旧版本IE下的HTMLCollection、NodeList不是object下的子类，浏览器会报异常，所以来看看jquery是怎么实现的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//jQuery makeArray</span></div><div class="line"><span class="keyword">var</span> makeArray = <span class="function"><span class="keyword">function</span>(<span class="params">array</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ret = []</div><div class="line">  <span class="keyword">if</span> (array != <span class="literal">null</span>) &#123;</div><div class="line">    <span class="keyword">var</span> i = array.length</div><div class="line">    <span class="comment">//window对象 字符串 函数 也有length属性</span></div><div class="line">    <span class="keyword">if</span> (i == <span class="literal">null</span> || <span class="keyword">typeof</span> array === <span class="string">'String'</span> || jQuery.isFunction(array) ||array.setInterval)</div><div class="line">        ret[<span class="number">0</span>] = array</div><div class="line">    <span class="keyword">else</span></div><div class="line">        ret[--i] = array[i]</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">return</span> ret</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>主要原理是获取类数组的length属性的值，然后将类数组里的元素全都push到一个新的真实数组里去。</p><h4 id="Array-from（ES6）"><a href="#Array-from（ES6）" class="headerlink" title="Array.from（ES6）"></a>Array.from（ES6）</h4><p><code>Array.from</code>方法用于将两类对象转为真正的数组：类数组对象（array-like object）和可遍历（iterable）的对象（包括ES6新增的数据结构Set和Map）。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// NodeList对象</span></div><div class="line"><span class="keyword">let</span> ps = <span class="built_in">document</span>.querySelectorAll(<span class="string">'p'</span>);</div><div class="line"><span class="built_in">Array</span>.from(ps).forEach(<span class="function"><span class="keyword">function</span> (<span class="params">p</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(p);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// arguments对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> args = <span class="built_in">Array</span>.from(<span class="built_in">arguments</span>);</div><div class="line">  <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"><span class="comment">//字符串</span></div><div class="line"><span class="built_in">Array</span>.from(<span class="string">'hello'</span>)   <span class="comment">// ['h', 'e', 'l', 'l', 'o']</span></div><div class="line"></div><div class="line"><span class="comment">//Set对象</span></div><div class="line"><span class="keyword">let</span> namesSet = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="string">'a'</span>, <span class="string">'b'</span>])</div><div class="line"><span class="built_in">Array</span>.from(namesSet) <span class="comment">// ['a', 'b']</span></div></pre></td></tr></table></figure><h4 id="…（ES6）"><a href="#…（ES6）" class="headerlink" title="…（ES6）"></a><strong>…</strong>（ES6）</h4><p><code>...</code>是ES6中新增的扩展运算符，也可以将某些数据结构转为数组。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// arguments对象</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> args = [...arguments];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// NodeList对象</span></div><div class="line">[...document.querySelectorAll(<span class="string">'div'</span>)]</div></pre></td></tr></table></figure><h3 id="思考？数据化跟length属性有关么？"><a href="#思考？数据化跟length属性有关么？" class="headerlink" title="思考？数据化跟length属性有关么？"></a>思考？数据化跟length属性有关么？</h3><p>在jQuery的数组化过程中我们看到了剔除了带有length属性的window、string、function，我们也在<code>Array.prototype.slice.call</code>里试一试</p><p><img src="http://ob3wg7deo.bkt.clouddn.com/14715012487175.jpg" alt=""></p><p>很明显<code>Array.prototype.slice.call</code>没有经过考验，把带有length属性的对象都slice成了数组。</p><p>实际上，js中的几种数组化的方法，都是调用遍历器接口<code>Symbol.iterator</code>，如果一个对象没有部署，就无法转换。<br><strong><code>Array.prototype.slice.call</code>和<code>Array.from</code>还支持转换类数组对象（本质特征就是有length属性），也就是说任何有length属性的对象都可以通过这两种方法转换成数组，而<code>...</code>不行。</strong><br><strong>并且<code>Array.prototype.slice.call</code>和<code>Array.from</code>的返回结果还有一些不同</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a = &#123; length: <span class="number">2</span> &#125;</div><div class="line"></div><div class="line">[...a]</div><div class="line"><span class="built_in">Array</span>.from(a)</div><div class="line"><span class="built_in">Array</span>.prototype.slice.call(a)</div></pre></td></tr></table></figure><p><img src="http://ob3wg7deo.bkt.clouddn.com/14785121041337.jpg" alt=""></p><p>我们可以看到：<br>1.<code>...</code>不能直接转换<code>{length:2}</code>这种对象。<br>2.<code>Array.from</code>返回一个100个成员的数组，并且每个成员都为<code>undefined</code><br>3.<code>Array.prototype.slice.call</code>返回一个length为100的数组，没有定义数组成员</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong>类数组对象</strong></p><ul><li>arguments</li><li>HTMLCollection</li><li>自定义对象arrayLike</li></ul><p><strong>js数组转换的方法</strong></p><ul><li>Array.prototype.slice.call</li><li>Array.from</li><li>…</li></ul><p><strong>带有length属性的特殊对象</strong></p><ul><li>数组</li><li>window对象</li><li>字符串</li><li>function</li></ul><p><strong>三种方法都是优先判断对象有没有遍历器接口（Symbol.iterator）来进行数组转换，<code>Array.prototype.slice.call</code>和<code>Array.from</code>还可以通过判断参数有没有length属性来转换数组</strong></p></div></article></div></section><footer><div class="paginator"><a href="/blog/2016/07/25/crontab入门/" class="prev">上一篇</a><a href="/blog/2016/03/13/使用nrm控制npm源/" class="next">下一篇</a></div><div data-thread-key="2016/06/08/js中的数组化/" data-title="js中的数组化" data-url="http://chenjiangsong.github.io/blog/blog/2016/06/08/js中的数组化/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery={short_name:"chenjiangsong"};!function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==document.location.protocol?"https:":"http:")+"//static.duoshuo.com/embed.js",t.charset="UTF-8",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(t)}()</script><div class="copyright"><p>© 2015 - 2016 <a href="http://chenjiangsong.github.io/blog">Jesse</a>, I'm a coder for Bruce Wayne.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="//cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script><script src="/blog/js/tag.js"></script><script>!function(e,t,a,n,c,o){e.GoogleAnalyticsObject=n,e[n]||(e[n]=function(){(e[n].q=e[n].q||[]).push(arguments)}),e[n].l=+new Date,c=t.createElement(a),o=t.getElementsByTagName(a)[0],c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script","ga"),ga("create","UA-65933410-1","auto"),ga("send","pageview")</script></body></html>